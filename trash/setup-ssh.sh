#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è NORMALDANCE

echo "üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è NORMALDANCE"
echo "========================================"

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
TARGET_SERVER="176.108.246.49"
TARGET_USER="aendy"
KEY_NAME="id_ed25519_normaldance"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–ª—é—á–∞
if [ ! -f ~/.ssh/$KEY_NAME ]; then
    echo "üìù –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ SSH –∫–ª—é—á–∞..."
    ssh-keygen -t ed25519 -f ~/.ssh/$KEY_NAME -C "normaldance@$TARGET_SERVER" -N ""
    echo "‚úÖ –ö–ª—é—á —Å–æ–∑–¥–∞–Ω: ~/.ssh/$KEY_NAME"
fi

# –ü–æ–∫–∞–∑–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
echo ""
echo "üîì –í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:"
echo "======================"
cat ~/.ssh/$KEY_NAME.pub
echo ""

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞
echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:"
echo "============================================="
echo "1. –í–æ–π–¥–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä $TARGET_SERVER –ª—é–±—ã–º –¥–æ—Å—Ç—É–ø–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º"
echo "2. –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: mkdir -p ~/.ssh"
echo "3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞: chmod 700 ~/.ssh"
echo "4. –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ —Ñ–∞–π–ª: echo '–ü–£–ë–õ–ò–ß–ù–´–ô_–ö–õ–Æ–ß_–í–´–®–ï' >> ~/.ssh/authorized_keys"
echo "5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞: chmod 600 ~/.ssh/authorized_keys"
echo ""

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è..."
echo "=============================="
if ssh -i ~/.ssh/$KEY_NAME -o ConnectTimeout=10 -o BatchMode=yes $TARGET_USER@$TARGET_SERVER exit 2>/dev/null; then
    echo "‚úÖ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!"
else
    echo "‚ùå SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."
fi

echo ""
echo "üöÄ –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "ssh -i ~/.ssh/$KEY_NAME $TARGET_USER@$TARGET_SERVER"