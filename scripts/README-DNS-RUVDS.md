# Настройка DNS для normaldance.ru через панель управления RUVDS

## Описание

Скрипт `setup-dns-ruvds.sh` предназначен для автоматизации процесса настройки DNS записей домена `normaldance.ru` через панель управления RUVDS. Скрипт включает в себя:

1. Автоматическое определение регистратора домена
2. Пошаговые инструкции по настройке DNS записей в панели управления RUVDS
3. Настройку A-записи для normaldance.ru и www.normaldance.ru
4. Настройку AAAA-записи (если IPv6 доступен)
5. Проверку правильности DNS записей
6. Создание файла с DNS записями для резервного копирования
7. Мониторинг распространения DNS по всему миру

## Требования

- Linux/Unix окружение (или WSL для Windows)
- Права root для выполнения скрипта
- Доступ к интернету
- Установленные утилиты: `dig`, `nslookup`, `whois`, `curl`

## Использование

### Базовое использование

```bash
sudo bash setup-dns-ruvds.sh
```

### Альтернативные варианты использования

```bash
# Настройка для другого домена
sudo bash setup-dns-ruvds.sh -d example.com

# Указание IP адреса вручную
sudo bash setup-dns-ruvds.sh -i 192.168.1.1

# Указание IPv6 адреса
sudo bash setup-dns-ruvds.sh -6 2001:db8::1

# Указание регистратора домена
sudo bash setup-dns-ruvds.sh -r "reg.ru"

# Только проверка текущих DNS записей
sudo bash setup-dns-ruvds.sh -v

# Только мониторинг DNS распространения
sudo bash setup-dns-ruvds.sh -m

# Только создание резервной копии
sudo bash setup-dns-ruvds.sh -b
```

### Справка

```bash
sudo bash setup-dns-ruvds.sh --help
```

## Пошаговый процесс работы скрипта

### 1. Проверка системы

- Проверка прав root
- Проверка наличия необходимых утилит
- Определение IP адреса сервера

### 2. Определение регистратора домена

- Автоматическое определение регистратора через whois
- Определение панели управления (reg.ru, nic.ru, cloudflare и др.)

### 3. Создание резервной копии

- Сохранение текущих DNS записей в файл
- Форматирование с датой и временем

### 4. Проверка текущих DNS

- Проверка NS, A, AAAA, MX, TXT записей
- Логирование текущего состояния

### 5. Отображение инструкций

- Пошаговые инструкции для настройки в RUVDS
- Подробные описания каждого шага
- Важные замечания и предупреждения

### 6. Подтверждение пользователя

- Запрос подтверждения перед началом настройки
- Возможность отмены процесса

### 7. Проверка после настройки

- Автоматическая проверка DNS записей
- Многократные попытки с интервалом в 1 минуту
- Ожидание полного распространения DNS

### 8. Мониторинг распространения

- Проверка через различные DNS серверы
- Сравнение результатов с ожидаемыми значениями
- Отчет о состоянии распространения

### 9. Создание конфигурационного файла

- Генерация файла с DNS конфигурацией
- Сохранение всех настроек для будущего использования

## Выходные файлы

Скрипт создает следующие файлы:

1. `dns-backup-YYYYMMDD-HHMMSS.txt` - Резервная копия DNS записей
2. `dns-setup-YYYYMMDD-HHMMSS.log` - Лог файл процесса настройки
3. `dns-config-normaldance.ru.conf` - Конфигурационный файл DNS

## Поддерживаемые регистраторы

Скрипт автоматически определяет следующие регистраторы:

- **reg.ru** - Регистратор доменов REG.RU
- **nic.ru** - НИЦ РЕГ
- **cloudflare** - Cloudflare
- **ruvds** - RUVDS
- **other** - Другие регистраторы

## Инструкции для RUVDS

### Шаг 1: Вход в панель управления

1. Перейдите на сайт https://cp.ruvds.com/
2. Введите ваш логин и пароль
3. Нажмите 'Войти'

### Шаг 2: Переход в раздел управления DNS

1. В левом меню найдите раздел 'Домены' или 'DNS'
2. Выберите 'Управление DNS' или 'DNS-записи'
3. Если у вас несколько доменов, выберите normaldance.ru

### Шаг 3: Настройка A-записи

1. Нажмите 'Добавить запись' или 'Создать запись'
2. В поле 'Тип' выберите 'A'
3. В поле 'Имя' оставьте пустым (или @ для основного домена)
4. В поле 'Значение' введите IP адрес сервера
5. В поле 'TTL' оставьте значение по умолчанию (обычно 3600)
6. Нажмите 'Сохранить'

### Шаг 4: Настройка A-записи для www

1. Нажмите 'Добавить запись' или 'Создать запись'
2. В поле 'Тип' выберите 'A'
3. В поле 'Имя' введите: www
4. В поле 'Значение' введите IP адрес сервера
5. В поле 'TTL' оставьте значение по умолчанию
6. Нажмите 'Сохранить'

### Шаг 5: Настройка IPv6 (если доступен)

1. Повторите шаги 3-4 для типа записи 'AAAA'
2. Используйте IPv6 адрес сервера

### Шаг 6: Проверка и сохранение

1. Убедитесь, что все записи добавлены корректно
2. Проверьте, что нет дублирующихся записей
3. Нажмите 'Сохранить' или 'Применить изменения'
4. Дождитесь применения изменений (обычно 15-60 минут)

## Важные замечания

1. **Время распространения DNS**: Изменения могут распространяться от 15 минут до 48 часов
2. **Проверка**: Рекомендуется проверить работу сайта в разных регионах
3. **SSL сертификат**: Обновите SSL сертификат после настройки DNS
4. **Резервное копирование**: Регулярно создавайте резервные копии DNS записей
5. **Мониторинг**: Используйте опцию `-m` для проверки распространения DNS

## Возможные проблемы и решения

### Проблема: DNS записи не обновляются

- **Решение**: Проверьте TTL записи, увеличьте время ожидания
- **Решение**: Убедитесь, что NS записи указывают на правильные серверы

### Проблема: Сайт не работает через www

- **Решение**: Проверьте A запись для www поддомена
- **Решение**: Убедитесь, что CNAME запись настроена правильно

### Проблема: IPv6 не работает

- **Решение**: Проверьте поддержку IPv6 на вашем сервере
- **Решение**: Убедитесь, что AAAA записи добавлены корректно

## Техническая поддержка

При возникновении проблем:

1. Проверьте лог файл `dns-setup-*.log`
2. Создайте резервную копию текущих DNS записей
3. Обратитесь в поддержку RUVDS
4. Проверьте настройки в панели управления регистратора

## Лицензия

Скрипт предоставляется как есть без гарантий. Используйте на свой страх и риск.
