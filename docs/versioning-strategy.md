# Стратегия управления версиями NormalDANCE

## Описание

Эта документация описывает стратегию управления версиями для NormalDANCE, основанную на семантическом версировании (SemVer) и интегрированную с процессом CI/CD.

## Семантическое версирование (SemVer)

### Формат версий

Версии NormalDANCE следуют формату: `MAJOR.MINOR.PATCH`

- **MAJOR** (основная версия): Изменения, нарушающие обратную совместимость
- **MINOR** (дополнительная версия): Новая функциональность с обратной совместимостью
- **PATCH** (исправление): Исправление ошибок с обратной совместимостью

### Примеры версий

- `1.0.0` - Первоначальный релиз
- `1.0.1` - Исправление ошибок
- `1.1.0` - Новая функциональность
- `2.0.0` - Изменения, нарушающие обратную совместимость

## Правила определения версий

### Major версии (MAJOR)

Используются при наличии изменений, нарушающих обратную совместимость:

- Удаление API эндпоинтов
- Изменение структуры базы данных
- Удаление конфигурационных опций
- Major обновления зависимостей
- Изменения в архитектуре приложения

**Примеры коммитов:**
- `feat: breaking change - remove deprecated API`
- `refactor: major database schema change`
- `fix: critical security issue requiring breaking change`

### Minor версии (MINOR)

Используются при добавлении новой функциональности с сохранением обратной совместимости:

- Новый API эндпоинт
- Новая страница или компонент
- Новая функция в существующем модуле
- Улучшения производительности
- Новые опции конфигурации

**Примеры коммитов:**
- `feat: add new user dashboard`
- `feat: implement track recommendations`
- `feat: add NFT marketplace`

### Patch версии (PATCH)

Используются для исправления ошибок и небольших улучшений:

- Исправление багов
- Небольшие улучшения UI
- Оптимизация производительности
- Обновления документации
- Небольшие исправления в коде

**Примеры коммитов:**
- `fix: resolve login issue`
- `fix: audio player crash`
- `docs: update API documentation`

## Процесс управления версиями

### 1. Разработка

Во время разработки разработчики должны использовать следующие префиксы в коммитах:

- `feat:` - Новая функциональность
- `fix:` - Исправление ошибок
- `docs:` - Документация
- `style:` - Форматирование кода
- `refactor:` - Рефакторинг
- `test:` - Тесты
- `chore:` - Рутинные задачи

### 2. Автоматическое определение версии

GitHub Actions автоматически определяет тип версии на основе:

1. **Pull Request merge**: Анализирует коммиты в PR для определения типа версии
2. **Manual trigger**: Позволяет вручную выбрать тип версии
3. **Release creation**: Создает patch версию при создании релиза

### 3. Ручное управление версиями

Для ручного управления версиями используйте скрипты:

```bash
# Увеличить версию
npm run version:major    # Major версия
npm run version:minor    # Minor версия  
npm run version:patch    # Patch версия

# Получить отчет о версиях
npm run version:report

# Показать текущую версию
npm run version:current
```

## Changelog

### Формат

Changelog следует формату [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/):

```markdown
# Список изменений

## [1.0.1] - 2024-01-15

### Добавлено
- Новая функциональность

### Изменено
- Обновления существующего функционала

### Исправлено
- Исправление ошибок

### Безопасность
- Обновления безопасности
```

### Автоматическое обновление

Changelog автоматически обновляется при создании новой версии через GitHub Actions.

## CI/CD интеграция

### GitHub Workflow

Основной workflow `.github/workflows/version-management.yml` включает:

1. **Version Validation**: Проверка коммитов для определения типа версии
2. **Version Management**: Обновление версий в package.json и changelog
3. **Release Management**: Создание релизов и артефактов
4. **Deployment**: Развертывание в staging/production
5. **Notification**: Уведомления о результатах

### Среды развертывания

- **Staging**: Тестирование новых версий перед выпуском
- **Production**: Официальный релиз для пользователей

### Процесс развертывания

1. Разработка в ветке `develop`
2. Merge в `main` запускает проверку версии
3. Автоматическое создание релиза
4. Развертывание в staging
5. Тестирование и проверка
6. Развертывание в production

## Обратная совместимость

### Проверки совместимости

Система автоматически проверяет обратную совместимость при каждом релизе:

- **API совместимость**: Проверка эндпоинтов
- **База данных**: Проверка схемы
- **Конфигурация**: Проверка переменных окружения
- **Зависимости**: Проверка совместимости
- **Breaking changes**: Проверка критических изменений

### Ручная проверка

Для ручной проверки совместимости используйте:

```bash
# Проверить совместимость
npm run compatibility:check

# Сгенерировать отчет
npm run compatibility:report

# Валидировать релиз
npm run compatibility:validate

# Создать migration guide
npm run compatibility:guide
```

### Migration Guides

При наличии breaking изменений автоматически создается migration guide:

- Расположение: `docs/migration-guide-v{version}.md`
- Содержит инструкции по миграции
- Включает план отката

## Уведомления о версиях

### Каналы уведомлений

- **Slack**: Канал `#deployments`
- **GitHub Releases**: Официальные релизы
- **Email**: Уведомления подписчикам

### Содержание уведомлений

- Номер версии
- Тип релиза (major/minor/patch)
- Изменения
- Ссылки на документацию
- Информация о развертывании

## Теги Git

### Автоматическое создание

Теги автоматически создаются при каждом релизе:

- Формат: `v{version}` (например, `v1.0.1`)
- Тип: Аннотированные теги
- Сообщение: Информация о релизе

### Управление тегами

```bash
# Показать существующие теги
npm run version:tags

# Создать тег вручную
git tag -a v1.0.1 -m "Release version 1.0.1"
git push origin v1.0.1
```

## Артефакты релиза

### Типы артефактов

Каждый релиз включает:

- **Source code**: ZIP и TAR.GZ архивы
- **Docker image**: Контейнер для развертывания
- **Build artifacts**: Скомпилированные файлы
- **Documentation**: Документация и migration guides

### Хранение артефактов

- **GitHub Releases**: Основное хранилище
- **Docker Hub**: Docker образы
- **CDN**: Статические файлы

## Откат версий

### Процесс отката

1. **Откат кода**: Возврат к предыдущей версии
2. **Откат базы данных**: Откат миграций
3. **Откат развертывания**: Откат на уровне инфраструктуры

### Автоматический откат

При критических ошибках:

1. Автоматическое уведомление
2. Откат на предыдущую стабильную версию
3. Создание issue для анализа проблемы

### Ручной откат

```bash
# Откат к предыдущей версии
git checkout v1.0.0
npm install
npm run deploy:production
```

## Мониторинг версий

### Версионное отслеживание

- **GitHub Releases**: История релизов
- **Changelog**: Подробный список изменений
- **Metrics**: Метрики использования версий

### Аналитика версий

- Популярность версий
- Скорость обновления
- Проблемы совместимости
- Производительность по версиям

## Best Practices

### Разработка

1. **Используйте осмысленные коммиты**: Четко описывайте изменения
2. **Следуйте соглашениям**: Используйте стандартные префиксы
3. **Проверяйте совместимость**: Тестируйте изменения на совместимость
4. **Документируйте изменения**: Обновляйте документацию

### Релизы

1. **Тестируйте thoroughly**: Проводите полное тестирование перед релизом
2. **Создавайте бэкапы**: Всегда делайте бэкап перед крупными релизами
3. **Планируйте откаты**: Имейте план отката на случай проблем
4. **Уведомляйте пользователей**: Сообщайте о важных изменениях

### Поддержка

1. **Отслеживайте обратную связь**: Собирайте отзывы пользователей
2. **Быстро реагируйте**: Исправляйте критические проблемы оперативно
3. **Обновляйте документацию**: Держите документацию в актуальном состоянии
4. **Обучайте команду**: Регулярно проводите обучение по новым версиям

## Инструменты

### Автоматизация

- **GitHub Actions**: CI/CD pipeline
- **Version Manager**: Скрипты управления версиями
- **Compatibility Manager**: Проверки совместимости

### Ручные инструменты

- **Git**: Контроль версии кода
- **npm/yarn**: Управление зависимостями
- **Docker**: Контейнеризация
- **Kubernetes**: Оркестрация

## Контактная информация

По вопросам управления версиями обращайтесь:

- **Email**: versions@normaldance.com
- **Slack**: Канал `#versions`
- **GitHub Issues**: https://github.com/normaldance/normaldance/issues

---

**Версия документа:** 1.0.1  
**Дата последнего обновления:** 2025-09-01  
**Автор:** NormalDance DevOps Team